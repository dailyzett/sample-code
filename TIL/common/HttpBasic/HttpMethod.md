## HTTP 메서드

### 1. 메서드의 종류

- GET : 리소스 조회
- POST : 데이터 처리, 주로 등록에 사용
- PUT : 리소스를 대체, 해당 리소스가 없으면 생성
- PATCH : 리소스 부분 변경
- DELETE : 리소스 삭제

- HEAD : GET과 동일하지만 메시지 부분을 제외하고 상태 줄과 헤더만 반환
- OPTIONS : 대상 리소스에 대한 통신 가능 옵션을 설명(주로 CORS에서 사용)
- CONNECT : 대상 리소스으로 식별되는 서버에 대한 터널을 설정
- TRACE : 대상 리소스에 따른 경로를 따라 메시지 루프백 테스트를 수행


### 2. GET

**자원 조회**의 역할을 하는 HTTP 메서드이다. 서버에 전달하고 싶은 정보는 쿼리스트링을 통해서 전달한다.

- 예시
```http request
GET /search?q=hello&hl=ko HTTP/1.1
HOST: www.google.com
```

Http 표준 스펙에는 GET도 메시지 바디를 통해 데이터를 전송할 수 있지만, 지원하는 곳이 많지 않기 때문에 권장되지 않는다.

#### 2.1 GET 메서드의 메시지 전달 방식

```http request
GET /boards/1 HTTP/1.1
Host:localhost:8080
```

클라이언트에서 보내는 HTTP 요청이 위와 같을 때 서버에서 보내는 데이터가 아래와 같다고 가정한다.

```text
{
    "username":"hong",
    "age":27
}
```

서버가 보내는 응답 데이터는 다음과 같다.

```http request
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 34

{
    "usernmae":"hong",
    "age":27
}
```

### 3. POST

요청 데이터를 처리하는 메서드이다. **메시지 바디를 통해 서버로 요청 데이터를 전달**한다.
메시지 바디를 통해 들어온 데이터를 처리하는 **모든 기능**을 수행한다.
주로 전달된 데이터로 신규 리소스 등록, 프로세스 처리에 사용한다.

#### 3.1 POST 메서드의 메시지 전달 방식

클라이언트가 서버에게 다음과 같은 요청을 보냈다고 생각해보자.

```http request
POST /boards HTTP/1.1
Content-Type: :application/json

{
    "username":"hong",
    "age":20
}
```

POST 메서드는 리소스 뒤에 식별자가 붙지 않는다. 하지만 신규 리소스를 생성할 때 서버는 **신규 리소스 식별자를 생성**해서 클라이언트에게 응답한다.
예를 들면 이런식이다.

```http request
HTTP/1.1 201 Created
Content-Type: application/json
Content-Length: 34
Location: /boards/100

{
    "username":"hong",
    "age":20
}
```

Location 을 보면 boards 뒤에 리소스 식별자가 생성된 것을 볼 수 있다.

#### 3.2 POST 메서드의 오해

POST 메서드의 가장 큰 오해는 신규 리소스를 등록할 때만 쓰인다는 말이다.
HTTP 표준 스펙을 번역하면 등록이란 말은 존재하지 않는다.

> POST 메서드는 대상 리소스가 리소스의 고유한 의미 체계에 따라 요청에 포함된 표현을 처리하도록 요청한다.

한마디로 신규 리소스를 생성할 뿐만 아니라, 거의 모든 기능을 수행할 수 있다는 말이된다.
POST 메서드는 다음과 같은 기능에 사용할 수 있다.

- HTML 양식에 입력된 데이터 블록을 데이터 처리 프로세스에 제공
- 서버가 아직 식별하지 않은 신규 리소스 생성
- 기존 리소스에 데이터 추가

정리하면 POST 메서드는 딱히 정해진 것이 없으며, POST 요청이 오면 그 요청마다 어떻게 처리해야할지는 리소스마다 따로 정해야한다.
POST를 Http의 생성 메서드라고 단언하면 안되는 이유는 새로운 리소스가 생성되지 않을 수도 있기 때문이다.
예를 들어 어떤 프로세스 처리에 있어 변경점이 있을 때도 POST 메서드가 사용된다.

```text
결제완료 > 배달시작 > 배달완료
```

위의 프로세스는 값 변경을 넘어 **프로세스의 상태**가 변경되는 경우이다. 프로세스 상태가 변경된 것이지 신규 리소스가 등록된 것이 아니다.
프로세스 처리에 따른 POST 메서드의 요청은 다음과 같이 설계할 수 있다.

```http request
POST /orders/{orderId}/start-delivery
```

리소스들은 명사로 선언하는 것이 맞으나 start-delivery 를 보면 동사로 선언되어 있다.
이것은 잘못된 설계 방식이지만 실무에서는 모든 상태들을 명사로 관리한다는 것은 불가능에 가깝기 때문에
지킬 수 있는 선에서 최대한 명사로 선언하되 어쩔 수 없는 것들은 동사로 선언하는 경우도 있다.
그리고 동사로 선언된 예시의 URI들을 **컨트롤 URI**라고 부른다.

### 4. PUT

리소스를 **대체**하는 메서드이다. 여기서 대체라는 말이 중요하다.
PUT 메서드는 데이터를 넘길 때 만약 해당하는 필드 개수가 맞지 않으면 맞지 않은 대로 데이터를 그대로 덮어버린다.

#### 4.1 PUT 메서드의 메시지 전달 방식

먼저 클라이언트가 보낸 요청 메시지의 메시지는 다음과 같다.

```http request
PUT /boards/1 HTTP/1.1
Content-Type: application/json

{
    "username":"hong",
    "age":50    
}
```

그리고 서버에서 가지고 있는 boards/1 의 데이터는 아래일 때는 필드 개수가 차이나지 않기 때문에 데이터 값의 변경만 일어난다.

```http request
{
    "username":"kim",
    "age":30
}
```
- 리소스 값의 변경만 일어난 서버 데이터
```
{
    "usnermae":"hong",
    "age":50
}
```

하지만 필드의 개수가 다를 때, PUT 메서드는 값의 변경만 하지 않는다.

- **클라이언트에서 보낸 요청 메시지**
```http request
PUT /boards/1 HTTP/1.1
Content-Type: application/json

{
    "age":50    
}
```
- **서버에 있는 데이터**
```http request
    "username":"kim",
    "age":30
```

- **요청을 받은 후 서버의 바뀐 데이터**
```http request
{
    "age":50
}
```

바뀐 데이터를 보면 username 필드가 그냥 날라가버렸다.
즉, PUT 메서드는 리소스의 변경이 아니라 리소스의 대체라고 봐야한다.
그렇다면 리소스의 값만 변경하고 싶을 때는 어떻게 해야할까?
그럴 때 PATCH 메서드를 사용하면 된다.

### 5. PATCH

- **클라이언트에서 보낸 요청 메시지**
```http request
PUT /boards/1 HTTP/1.1
Content-Type: application/json

{
    "age":50    
}
```

- **서버에 있는 데이터**
```http request
{
    "username":"kim",
    "age":30
}
```

- **요청을 받은 후 서버의 바뀐 데이터**
```http request
{
    "username":"kim",
    "age":50
}
```

보다시피 username 필드가 없어지지 않는다. 따라서 리소스의 일부만 변경해야할 때는 PATCH 메서드를 사용하자.


### 6. DELETE

DELETE는 말 그대로 리소스를 제거하기 위해 사용되는 메서드이다.
데이터를 삭제하기 위해 리소스 식별자를 지정해줘야한다.

### 7. HTTP 메서드 속성

HTTP 메서드의 속성은 3가지가 있다.

- 안전(Safe Methods)
- 멱등(Idempotent Methods)
- 캐시가능(Cacheable Methods)

#### 7.1 안전(Safe)

호출해도 리소스를 변경하지 않을 때 **안전**하다고 한다. GET이나 HEAD같은 단순 조회 메서드인 경우 안전하다고 볼 수 있다.
당연히 POST, PUT, DELETE, PATCH는 데이터를 변경하므로 안전하지 않은 메서드이다.

#### 7.2 멱등(Idempotent)

호출 횟수에 상관없이 그 결과가 똑같을 때, 그 메서드는 멱등하다고 말한다.

- GET : 몇 번을 조회하든 불러오는 데이터는 같다. 따라서 멱등하다
- PUT : 데이터를 대체하기 때문에 멱등하다. PUT 메서드는 데이터의 변경이 아니라 보낸 리소스들을 덮어씌우기
때문에 멱등하다고 봐야한다.
- DELETE : 멱등하다. 몇 번을 DELETE 해도 데이터가 삭제되었다는 결과는 같다.
- POST : POST는 멱등이 아니다. POST는 리소스에 따라 처리결과가 다른 메서드이다.
결제 관련해서 두 번 POST 메서드를 호출하면 같은 결제가 중복해서 발생할 수 있다.

HTTP 메서드에서 멱등성은 서버에서 에러가 났을 때 그 메서드를 다시 호출해도 될 것인가? 라는 판단 근거이다.
GET, PUT, DELETE는 서버가 에러났을 때 다시 메서드를 호출해도 상관없다. 하지만 서버 장애가 일어났다고 해서, 멱등하지 않은
POST 메서드를 여러 번 보내면 같은 결제가 여러 번 될 수도 있다. 그리고 이것은 대참사이다.

그리고 멱등이란 특성은 외부 요인으로 리소스가 변경되는 것까지는 보장하지 않는다.
GET 메서드로 age 가 30인 사람을 불러왔는데 외부에서 PUT 메서드가 개입해 age 를 50으로 바꿨다.
그러면 이후 GET 메서드는 그 사람을 불러올 때 age 데이터는 당연히 50이다.

#### 7.3 캐시 가능(Cacheable)

응답 결과 리소스를 캐시해서 사용해도 되는가? 가 판단 기준이다.
캐시를 사용하면 보다 빠르게 데이터 처리가 가능하다.
캐시 가능한 HTTP 메서드는 **GET, POST, HEAD, PATCH**가 있다.

다만 POST와 PATCH는 본문 내용까지 캐시 키로 구현해야하는데 이것은 쉽지 않은 작업이다.
반면 GET이나 HEAD는 URI를 토대로 캐시 적용이 가능하기 때문에 주로 조회 작업에 캐시가 사용된다.