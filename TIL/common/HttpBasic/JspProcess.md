## JSP의 처리 과정과 WAS 폴더 구성 및 URL

### 1. JSP 처리 과정

> JSP에 해당하는 서블릿이 존재하지 않는 경우
- JSP 페이지로부터 자바 코드 생성
- 자바 코드를 컴파일해서 서블릿 클래스 생성
- 서블릿에 클라이언트 요청 전달
- 서블릿이 요청을 처리한 결과를 응답으로 생성
- 응답을 웹 브라우저에 전송
  > 서블릿이 존재하는 경우
- 서블릿에 클라이언트 요청 전달
- 서블릿이 요청을 처리한 결과를 응답으로 생성
- 응답을 웹 브라우저에 전송 


### 2. 출력 버퍼와 응답

JSP 페이지는 응답 결과를 곧바로 웹 브라우저로 전송하지 않는다. 대신 출력 버퍼라는 곳에 응답을 저장했다가
한 번에 웹브라우저로 전송한다.

버퍼를 사용할 때 장점은 다음과 같다.

- 데이터 전송 성능 향상
- JSP 실행 도중에 버퍼를 비우고 새로운 내용 전송 가능
- 버퍼가 다 차기 전까지 헤더 변경 가능

> 전송 성능 향상 이유?

- 작은 단위로 데이터를 전송하는 것이 아니라 한 번에 큰 단위로 데이터를 전송하기 때문에 속도 측면에서 유리하다.
- WAS는 처음 버퍼의 내용을 웹 브라우저로 전송하기 전에 헤더 정보를 전송한다. 따라서 버퍼의 내용을 웹 브라우저에
전송하기 전에는 헤더 정보를 얼마든지 변경이 가능하다.


### 3. 웹 애플리케이션 폴더 구성과 URL 매핑

**서블릿/JSP 규약**은 웹 애플리케이션이 특정 폴더 구조를 따르도록 제한하고 있기 때문에, 폴더 구조를
모르면 제대로 동작하는 코드 작성이 불가능하다.

기본 폴더 구조는 다음과 같다.

- 웹 애플리케이션
  - WEB-INF
    - classes
    - lib

웹 애플리케이션 폴더는 웹 애플리케이션이 위치하는 폴더를 의미한다. 톰캣의 webapps 디렉터리의 하위 폴더들이
웹 애플리케이션 폴더에 해당한다.

- WEB-INF : 웹 애플리케이션 설정 정보를 담고 있는 web.xml 파일이 위치한다.
- WEB-INF/classes : 웹 애플리케이션에서 사용하는 클래스 파일이 위치한다.
- WEB-INF/lib : 웹 애플리케이션에서 사용하는 jar 파일이 위치한다.

WEB-INF 와 하위 폴더를 제외한 나머지 폴더에는 사용할 JSP, HTML, 이미지 파일 등이 위치한다.


> 서블릿 규약이 업데이트되면서 web.xml 파일은 꼭 없어도 되지만 다음과 같은 경우는 web.xml 파일을 작성해야한다.

- 서블릿을 직접 설정하는 경우
- 리스너를 직접 설정하는 경우
- 특정 URL에 속하는 JSP들에 대해 공통 속성값을 설정하는 경우

### 3.1 웹 애플리케이션 폴더와 URL 관계

> [톰캣]\webapps\[웹경로] -> http://host:port[/웹경로]

톰캣의 webapps 폴더에는 ROOT라는 특수 폴더가 있다. http://localhost:8080/chap04 에서
chap04를 컨텍스트 경로(context path)라고 한다. 만약 경로가 ROOT 일 경우 컨텍스트 경로는 빈 문자열인
"" 이다.

URL의 첫 번째 경로와 일치하는 컨텍스트 경로를 가진 웹 애플리케이션이 존재하지 않으면, 루트 웹 애플리케이션이
요청을 대신 처리한다.

> ex) http://localhost:8080/view/loginForm.jsp 를 입력했는데 /view 컨텍스트 경로가 없으면,
> 루트 웹 애플리케이션 폴더를 기준으로 /view/loginForm.jsp를 찾는다. 즉 webapps\ROOT\view\loginForm.jsp 파일을
> 찾아 실행한다.

request 기본 객체는 컨텍스트 경로를 제공하는 메서드를 정의하고 있다.
```jsp
request.getContextPath()
```


### 4. 웹 애플리케이션 배포

웹 애플리케이션을 WAS 에 배포하는 방법은 다음의 두 가지가 있다.
1. 대상 폴더에 파일을 직접 복사
2. war 파일로 묶어서 배포

1번은 톰캣의 webapps 하위 폴더에 직접 JSP 파일을 생성하는 방식이다.

2번의 war는 **Web Application Archive**의 약자로 웹 애플리케이션의 구성 요소를 하나로 묶어 놓은 파일이다.
war 파일로 묶으려면 JDK의 jar 명령어를 사용한다.

> 명령어 예시 : jar cvf chap04.war *

- c : 새로운 파일을 생성
- v : 세부 정보를 콘솔에 표시
- f : 생성할 파일 이름 지정
- \* : 현재 폴더의 모든 파일과 하위 폴더가 대상임을 의미

war 파일이 생성되면 이 파일을 [톰캣]\webapps 폴더에 복사해주면 배포가 된다.


#### JAR(Java Archive) vs WAR(Web Application Archive)

jar는 JAVA 애플리케이션이 동작할 수 있도록 JAVA 프로젝트를 압축한 파일이고, war는 servlet/jsp 컨테이너에
배치할 수 있는 웹 애플리케이션 압축 파일 포맷이다. war도 자바의 jar 옵션을 이용해 생성하는 jar 파일의 일종으로
웹애플리케이션 전체를 패키징하기 위한 jar파일로 생각하면 된다.

